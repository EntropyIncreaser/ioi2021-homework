首先注意到如果一个数有两种循环移位都是最大的，那么因为 $7$ 是质数，所以整个串一定是同一个数。这种数转到哪个位置也不影响答案，我们把它删掉。

接下来剩下的问题就是有一个 $a_i$ 数组，我们每次可以区间 $+x$，在 $\bmod 7$ 的意义下。考虑转为差分。如果差分中有一个 $x$ 与 $-x$ 都存在，不难发现最优解一定可以将他们配对。那么接下来 $1$ 与 $6$，$2$ 与 $5$，$3$ 与 $4$ 都是只有一者还有剩余的。我们考虑做一个 $O(n^3)$ 状态的 DP。其中 $f(i,j,k)$ 表示剩下的三类数还有多少个，剩下可能还剩一个拼的过程中的数，这是可以通过 $\bmod 7$ 唯一确定的。因此这就是一个 $O(n^3)$ 的 DP，我们还需要把其中一维滚动数组。
