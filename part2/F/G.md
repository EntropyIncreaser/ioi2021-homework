我们考虑对每个人的名字反过来建一个字典树。那么可以发现 AC 自动机上的 fail 树子树，就是一个字符串以其为前缀的所有人。我们建出 AC 自动机后在 fail 树上做一个前缀和，就足够询问答案了。复杂度是线性的。