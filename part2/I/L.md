我们考虑二分，然后查出每个位置如果建塔的话两边需要填充到哪，左边就是 $h_i - i$ 的单调栈，右边就是 $h_i + i$ 的单调栈。因此在上面二分就可以 $O(n\log^2 n)$ 了，其实建主席树的话大概可以做到 $O(n\log n)$，但是数据范围不太需要。
