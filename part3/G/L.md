如果一个节点有至少三条邻边有路径经过，那么显然不合法。

接下来我们就可以删去没有路径经过的边，剩下的图其实就是若干条链。我们按照路径从短到长的顺序处理，用链表类似的结构维护一下就好了。

如果前面的预处理有 $O(1)$ LCA 加上前缀和，后面用计数排序那就是 $\Theta(n)$ 的。

