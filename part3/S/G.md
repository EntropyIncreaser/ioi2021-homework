我们考虑先按照拓扑排序处理出当前度数为 $0$ 的集合。我们不难发现如果加边的话，只需是从 $p_i$ 到 $p_{i+1}$ 连的边，考虑维护两个集合 $D_0, D_1$，其中 $D_1$ 表示我们已经钦定了要有边连向它的。当我们确定拓扑排序的下一个值的时候，希望能够尽量将 $D_0$ 里的点挪到 $D_1$ 中，因为如果 $D_0$ 不为空，那么下一个点最大只能是 $D_0$ 中的最小元素，否则我们可以令它为 $D_1$ 中的最大元素。还有一个额外情况就是如果 $D_0$ 只有一个元素且大于 $D_1$ 的所有元素，就没必要挪过去了。用 $\texttt{set}$ 维护这两个集合，复杂度为 $O(m + n\log n)$。
